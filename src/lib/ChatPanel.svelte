<script lang="ts">
  import MessageInput from './MessageInput.svelte';
  import ChatBubble from './ChatBubble.svelte';
  import { onMount } from 'svelte';
  import type {ChatMessage} from "../App.svelte";

  export let messages: ChatMessage[] = [];
  export let topic: string;
  let newMessage = '';

  onMount(() => {
    const storedMessages = localStorage.getItem('chatMessages');
    if (storedMessages) {
      messages = JSON.parse(storedMessages);
    }
  });

  function sendMessage() {
    if (newMessage.trim()) {
      const newMsg: ChatMessage = { text: newMessage, role: 'user', key: messages.length };
      messages = [...messages, newMsg];
      localStorage.setItem('chatMessages', JSON.stringify(messages));
      newMessage = '';
      console.log(localStorage.getItem('chatMessages'));
    }
  }
</script>

<div class="space-y-4 flex-1 overflow-y-auto bg-gray-100 p-4 w-full">
  <h2 class="text-xl text-blue-700 font-semibold text-center">{topic}</h2>
  {#each messages as { text, role }, index}
    <ChatBubble message={text} role={role} key={index} />
  {/each}
</div>

<MessageInput bind:newMessage={newMessage} sendMessage={sendMessage} />

<style>
  :global(body) {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    width: 100%;
  }
</style>